<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Розрахунок вартості фігурки</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 400px;
      margin: 20px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #f9f9f9;
    }
    h2, h3 {
      text-align: center;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
    }
    .note {
      margin-top: 20px;
      padding: 10px;
      font-size: 14px;
      line-height: 1.5;
      background-color: #f1f9ff;
      border: 1px solid #d6e9ff;
      border-radius: 8px;
    }
    .figure-container {
      margin-top: 20px;
      border-top: 1px dashed #ccc;
      padding-top: 10px;
    }
    .remove-btn {
      background-color: #e74c3c;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      margin-top: 10px;
    }
    .remove-btn:hover {
      background-color: #c0392b;
    }
  </style>
</head>
<body>
  <h2>Розрахунок вартості фігурки</h2>
  <label for="exchange-rate">Актуальний курс (mono):</label>
  <input type="number" id="exchange-rate" placeholder="Курс завантажується..." disabled>

  <div id="figures-container"></div>
  <button id="add-figure-btn">Додати фігурку</button>

  <div class="result">
    <p>Загальна сума для всіх фігурок: <span id="total-sum">0</span> грн</p>
  </div>

  <div class="note">
    <strong>Примітка:</strong> Загальна сума вказана без врахування доставки з США в Україну. Вона буде розрахована після прибуття фігурок на склад. Середні значення за доставку фігурок, на основі попередніх замовлень: 
    <ul>
      <li>4-inch — 80-120 грн</li>
      <li>6-inch/DELUXE — 150-250 грн</li>
    </ul>
  </div>

  <script>
    const exchangeRateInput = document.getElementById("exchange-rate");
    const figuresContainer = document.getElementById("figures-container");
    const addFigureBtn = document.getElementById("add-figure-btn");
    const totalSumOutput = document.getElementById("total-sum");

    let exchangeRate = 0;

    // Функція для автоматичного отримання курсу з API Monobank для продажу
    async function fetchExchangeRate() {
      try {
        const response = await fetch("https://api.monobank.ua/bank/currency");
        const data = await response.json();
        const usdRate = data.find(rate => rate.currencyCodeA === 840 && rate.currencyCodeB === 980);

        if (usdRate) {
          exchangeRate = usdRate.rateSell;
          exchangeRateInput.value = exchangeRate.toFixed(2);
        } else {
          throw new Error("Не вдалося знайти курс USD/UAH.");
        }
      } catch (error) {
        console.error("Помилка при отриманні курсу:", error);
        exchangeRateInput.placeholder = "Не вдалося завантажити курс";
      }
    }

    // Функція для створення блоку фігурки
    function addFigure() {
      const figureDiv = document.createElement("div");
      figureDiv.classList.add("figure-container");

      figureDiv.innerHTML = `
        <label>Ціна фігурки ($):</label>
        <input type="number" class="figure-price" placeholder="Введіть ціну">
        <p>Податок (7%): <span class="figure-tax">0</span> грн</p>
        <p>Страховка (0.5%): <span class="figure-insurance">0</span> грн</p>
        <p>Сума без комісії: <span class="figure-subtotal">0</span> грн</p>
        <p>Загальна сума: <span class="figure-total">0</span> грн</p>
        <button class="remove-btn">Видалити</button>
      `;

      figuresContainer.appendChild(figureDiv);

      const priceInput = figureDiv.querySelector(".figure-price");
      const taxOutput = figureDiv.querySelector(".figure-tax");
      const insuranceOutput = figureDiv.querySelector(".figure-insurance");
      const subtotalOutput = figureDiv.querySelector(".figure-subtotal");
      const totalOutput = figureDiv.querySelector(".figure-total");
      const removeBtn = figureDiv.querySelector(".remove-btn");

      // Оновлення розрахунків для однієї фігурки
      function calculateFigure() {
        const price = parseFloat(priceInput.value) || 0;

        const tax = price * exchangeRate * 0.07;
        const insurance = price * exchangeRate * 0.005;
        const subtotal = price * exchangeRate + tax + insurance;
        const total = subtotal + 40;

        taxOutput.textContent = tax.toFixed(2);
        insuranceOutput.textContent = insurance.toFixed(2);
        subtotalOutput.textContent = subtotal.toFixed(2);
        totalOutput.textContent = total.toFixed(2);

        calculateTotalSum();
      }

      // Видалення блоку фігурки
      removeBtn.addEventListener("click", () => {
        figureDiv.remove();
        calculateTotalSum();
      });

      // Слухач подій для оновлення
      priceInput.addEventListener("input", calculateFigure);
    }

    // Функція для розрахунку загальної суми
    function calculateTotalSum() {
      const totalFigures = Array.from(document.querySelectorAll(".figure-total"));
      const totalSum = totalFigures.reduce((sum, total) => sum + parseFloat(total.textContent || 0), 0);

      totalSumOutput.textContent = totalSum.toFixed(2);
    }

    // Слухач для додавання нової фігурки
    addFigureBtn.addEventListener("click", addFigure);

    // Завантаження курсу при відкритті сторінки
    window.onload = () => {
      fetchExchangeRate();
      addFigure(); // Додаємо поле для першої фігурки
    };
  </script>
</body>
</html>
