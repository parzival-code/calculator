<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Калькулятор спільного замовлення</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #f1f5f9;
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 30px auto;
      background: white;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .logo {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .logo img {
      width: 80px;
    }
    h1 {
      text-align: center;
      color: #0056b3;
      margin-bottom: 15px;
    }
    h2 {
      text-align: center;
      color: #333;
      margin: 15px 0;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #e6f7ff;
      border: 1px solid #40a9ff;
      border-radius: 5px;
    }
    .btn {
      display: inline-block;
      margin: 10px 0;
      padding: 10px 15px;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
      width: 100%;
      font-size: 16px;
    }
    .btn:hover {
      background-color: #218838;
    }
    input {
      width: calc(100% - 20px);
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
    }
    .note {
      margin-top: 20px;
      padding: 15px;
      background: #fffbe6;
      border: 1px solid #ffe58f;
      border-radius: 5px;
      font-size: 14px;
      color: #555;
      line-height: 1.5;
    }
    .note ul {
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="logo.png" alt="Логотип">
    </div>
    <h1>Розрахунок вартості фігурки</h1>
    <h2>Курс USD (Monobank): <span id="exchangeRate">Завантаження...</span></h2>

    <h2>Додайте ціни на фігурки</h2>
    <div id="figuresContainer">
      <input type="number" class="figurePrice" placeholder="Ціна фігурки ($)" step="0.01">
    </div>
    <button class="btn" onclick="addFigure()">Додати ще одну фігурку</button>
    
    <div class="result">
      <p id="totalWithDelivery"></p>
      <p id="totalWithoutDelivery"></p>
    </div>
    <button class="btn" onclick="calculateTotal()">Розрахувати загальну суму</button>
    <div class="note">
      <p>
        Загальна сума вказана без врахування доставки з США в Україну. Вона буде розрахована після прибуття фігурок на склад. 
        Середні значення за доставку фігурок, на основі попередніх замовлень:
      </p>
      <ul>
        <li>4-inch — 80-120 грн</li>
        <li>6-inch/DELUXE — 150-250 грн</li>
      </ul>
    </div>
  </div>

  <script>
    const taxRate = 0.07; // Податок 7%
    const insuranceRate = 0.005; // Страховка 0.5%
    const fixedCommission = 40; // Фіксована комісія
    let exchangeRate = 0; // Курс продажу USD

    // Отримання курсу Monobank
    async function fetchExchangeRate() {
      try {
        const response = await fetch('https://api.monobank.ua/bank/currency');
        const data = await response.json();
        const usdCurrency = data.find(item => item.currencyCodeA === 840 && item.currencyCodeB === 980);
        if (usdCurrency) {
          exchangeRate = usdCurrency.rateSell; // Курс продажу USD
          document.getElementById('exchangeRate').innerText = exchangeRate.toFixed(2) + ' грн';
        } else {
          document.getElementById('exchangeRate').innerText = 'Недоступно';
          alert('Не вдалося завантажити курс USD.');
        }
      } catch (error) {
        document.getElementById('exchangeRate').innerText = 'Помилка';
        console.error('Помилка завантаження курсу:', error);
      }
    }

    fetchExchangeRate();

    function addFigure() {
      const container = document.getElementById('figuresContainer');
      const input = document.createElement('input');
      input.type = 'number';
      input.className = 'figurePrice';
      input.placeholder = 'Ціна фігурки ($)';
      input.step = '0.01';
      container.appendChild(input);
    }

    function calculateTotal() {
      if (exchangeRate <= 0) {
        alert('Курс ще не завантажений.');
        return;
      }
      const prices = document.querySelectorAll('.figurePrice');
      let totalWithoutDelivery = 0;
      let totalWithDelivery = 0;

      prices.forEach(priceInput => {
        const price = parseFloat(priceInput.value) || 0;
        const tax = price * exchangeRate * taxRate;
        const insurance = price * exchangeRate * insuranceRate;
        const total = price * exchangeRate + tax + insurance + fixedCommission;

        totalWithoutDelivery += price * exchangeRate + tax + insurance;
        totalWithDelivery += total;
      });

      document.getElementById('totalWithoutDelivery').innerText = `Сума без комісії: ${totalWithoutDelivery.toFixed(2)} грн`;
      document.getElementById('totalWithDelivery').innerText = `Загальна сума: ${totalWithDelivery.toFixed(2)} грн`;
    }
  </script>
</body>
</html>
